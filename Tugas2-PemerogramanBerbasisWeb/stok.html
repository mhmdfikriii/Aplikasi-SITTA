<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stok Bahan Ajar - SITTA UT</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="app">
        <!-- PENJELASAN VIDEO: Navbar navigation yang konsisten di semua halaman -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow">
            <div class="container-fluid">
                <a class="navbar-brand fw-bold" href="index.html">
                    <i class="bi bi-book-half"></i> SITTA - UT
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">
                                <i class="bi bi-house-door"></i> Beranda
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="stok.html">
                                <i class="bi bi-box-seam"></i> Stok Bahan Ajar
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="tracking.html">
                                <i class="bi bi-truck"></i> Tracking DO
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="laporan.html">
                                <i class="bi bi-graph-up"></i> Laporan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="katalog.html">
                                <i class="bi bi-book"></i> Katalog
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid py-4">
            <!-- PENJELASAN VIDEO: Header dengan statistik real-time menggunakan computed properties -->
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="fw-bold mb-3">
                        <i class="bi bi-box-seam"></i> Manajemen Stok Bahan Ajar
                    </h2>
                </div>
            </div>

            <!-- PENJELASAN VIDEO: Statistics Cards - menggunakan computed untuk menghitung data secara dinamis -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="bi bi-boxes"></i> Total Stok
                            </h6>
                            <h3 class="fw-bold">{{ totalItems }}</h3>
                            <small>Item Bahan Ajar</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="bi bi-check-circle"></i> Stok Aman
                            </h6>
                            <h3 class="fw-bold">{{ stockAman }}</h3>
                            <small>Item Normal</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card bg-warning text-dark">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="bi bi-exclamation-triangle"></i> Stok Menipis
                            </h6>
                            <h3 class="fw-bold">{{ stockMenipis }}</h3>
                            <small>Perlu Re-Order</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card bg-danger text-white">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="bi bi-x-circle"></i> Stok Kosong
                            </h6>
                            <h3 class="fw-bold">{{ stockKosong }}</h3>
                            <small>Segera Order</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PENJELASAN VIDEO: Filter Section dengan v-model untuk two-way data binding -->
            <div class="filter-section mb-4">
                <div class="row align-items-end">
                    <div class="col-md-12 mb-3">
                        <h5 class="fw-bold">
                            <i class="bi bi-funnel"></i> Filter & Pencarian
                        </h5>
                    </div>
                    
                    <!-- PENJELASAN VIDEO: Search box dengan v-model untuk reactive search -->
                    <div class="col-md-4 mb-3">
                        <label class="form-label fw-semibold">
                            <i class="bi bi-search"></i> Pencarian
                        </label>
                        <input type="text" 
                               class="form-control" 
                               v-model="searchQuery"
                               placeholder="Cari kode atau nama mata kuliah...">
                    </div>

                    <!-- PENJELASAN VIDEO: Filter UT Daerah dengan v-model dan watcher untuk dependent options -->
                    <div class="col-md-3 mb-3">
                        <label class="form-label fw-semibold">
                            <i class="bi bi-building"></i> UT Daerah
                        </label>
                        <select class="form-select" v-model="filterUTPJJ">
                            <option value="">Semua UT Daerah</option>
                            <option v-for="upbjj in upbjjList" :key="upbjj" :value="upbjj">
                                {{ upbjj }}
                            </option>
                        </select>
                    </div>

                    <!-- PENJELASAN VIDEO: Dependent filter - kategori muncul setelah memilih UT (v-if) -->
                    <div class="col-md-3 mb-3" v-if="filterUTPJJ">
                        <label class="form-label fw-semibold">
                            <i class="bi bi-tags"></i> Kategori
                        </label>
                        <select class="form-select" v-model="filterKategori">
                            <option value="">Semua Kategori</option>
                            <option v-for="cat in availableCategories" :key="cat" :value="cat">
                                {{ cat }}
                            </option>
                        </select>
                    </div>

                    <!-- PENJELASAN VIDEO: Sort options dengan v-model -->
                    <div class="col-md-2 mb-3">
                        <label class="form-label fw-semibold">
                            <i class="bi bi-sort-down"></i> Urutkan
                        </label>
                        <select class="form-select" v-model="sortBy">
                            <option value="judul">Nama A-Z</option>
                            <option value="judul-desc">Nama Z-A</option>
                            <option value="qty">Stok Terendah</option>
                            <option value="qty-desc">Stok Tertinggi</option>
                            <option value="harga">Harga Terendah</option>
                            <option value="harga-desc">Harga Tertinggi</option>
                        </select>
                    </div>
                </div>

                <!-- PENJELASAN VIDEO: Filter checkbox untuk alert stok (v-model dengan checkbox) -->
                <div class="row mt-2">
                    <div class="col-md-12">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" 
                                   type="checkbox" 
                                   id="filterAlert"
                                   v-model="showAlertOnly">
                            <label class="form-check-label fw-semibold text-warning" for="filterAlert">
                                <i class="bi bi-exclamation-triangle"></i> 
                                Tampilkan hanya stok yang perlu di-reorder (Menipis & Kosong)
                            </label>
                        </div>
                        <button class="btn btn-outline-secondary btn-sm ms-3" @click="resetFilters">
                            <i class="bi bi-arrow-clockwise"></i> Reset Filter
                        </button>
                        <button class="btn btn-primary btn-sm ms-2" @click="showAddModal = true">
                            <i class="bi bi-plus-circle"></i> Tambah Bahan Ajar Baru
                        </button>
                    </div>
                </div>
            </div>

            <!-- PENJELASAN VIDEO: Alert info jumlah hasil filter menggunakan computed property -->
            <div class="alert alert-info" v-if="filteredData.length > 0">
                <i class="bi bi-info-circle"></i> 
                Menampilkan <strong>{{ filteredData.length }}</strong> dari <strong>{{ bahanAjarList.length }}</strong> item
            </div>
            <div class="alert alert-warning" v-else>
                <i class="bi bi-exclamation-triangle"></i> 
                Tidak ada data yang sesuai dengan filter
            </div>

            <!-- PENJELASAN VIDEO: Table dengan v-for untuk list rendering -->
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-primary">
                                <tr>
                                    <th>No</th>
                                    <th>Kode/Nama MK</th>
                                    <th>Kategori</th>
                                    <th>UT Daerah</th>
                                    <th>Lokasi Rak</th>
                                    <th class="text-center">Qty</th>
                                    <th class="text-center">Safety</th>
                                    <th class="text-center">Status</th>
                                    <th>Harga</th>
                                    <th class="text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- PENJELASAN VIDEO: v-for dengan :key untuk render list, v-if untuk conditional rendering -->
                                <tr v-for="(item, index) in paginatedData" :key="item.id">
                                    <td>{{ (currentPage - 1) * itemsPerPage + index + 1 }}</td>
                                    <td>
                                        <strong>{{ item.kode }}</strong><br>
                                        <small class="text-secondary">{{ item.judul }}</small>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">{{ item.kategori }}</span>
                                    </td>
                                    <td>{{ item.upbjj }}</td>
                                    <td>
                                        <i class="bi bi-pin-map"></i> {{ item.lokasiRak }}
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-info">{{ item.qty }}</span>
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-secondary">{{ item.safety }}</span>
                                    </td>
                                    <td class="text-center">
                                        <!-- PENJELASAN VIDEO: Conditional rendering dengan v-if, v-else-if, v-else -->
                                        <span v-if="item.qty === 0" class="status-kosong">
                                            <i class="bi bi-x-circle"></i> Kosong
                                        </span>
                                        <span v-else-if="item.qty < item.safety" class="status-menipis">
                                            <i class="bi bi-exclamation-triangle"></i> Menipis
                                        </span>
                                        <span v-else class="status-aman">
                                            <i class="bi bi-check-circle"></i> Aman
                                        </span>
                                    </td>
                                    <td>Rp {{ formatCurrency(item.harga) }}</td>
                                    <td class="text-center">
                                        <button class="btn btn-sm btn-warning" 
                                                @click="editItem(item)">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                        <button class="btn btn-sm btn-info ms-1" 
                                                @click="viewDetail(item)">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- PENJELASAN VIDEO: Pagination dengan computed properties -->
                    <nav v-if="totalPages > 1">
                        <ul class="pagination justify-content-center">
                            <li class="page-item" :class="{ disabled: currentPage === 1 }">
                                <a class="page-link" @click.prevent="currentPage--">Previous</a>
                            </li>
                            <li class="page-item" 
                                v-for="page in totalPages" 
                                :key="page"
                                :class="{ active: currentPage === page }">
                                <a class="page-link" @click.prevent="currentPage = page">{{ page }}</a>
                            </li>
                            <li class="page-item" :class="{ disabled: currentPage === totalPages }">
                                <a class="page-link" @click.prevent="currentPage++">Next</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        <!-- PENJELASAN VIDEO: Modal untuk Edit Bahan Ajar dengan v-show -->
        <div class="modal fade" :class="{ show: showEditModal, 'd-block': showEditModal }" 
             v-show="showEditModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-warning">
                        <h5 class="modal-title">
                            <i class="bi bi-pencil"></i> Edit Stok Bahan Ajar
                        </h5>
                        <button type="button" class="btn-close" @click="closeEditModal"></button>
                    </div>
                    <div class="modal-body">
                        <form @submit.prevent="saveEdit">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Kode MK</label>
                                    <input type="text" class="form-control" v-model="editForm.kode" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Nama MK</label>
                                    <input type="text" class="form-control" v-model="editForm.judul" readonly>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Jumlah Stok *</label>
                                    <input type="number" class="form-control" v-model.number="editForm.qty" required min="0">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Safety Stock *</label>
                                    <input type="number" class="form-control" v-model.number="editForm.safety" required min="0">
                                </div>
                                <div class="col-md-12 mb-3">
                                    <label class="form-label fw-semibold">Lokasi Rak</label>
                                    <input type="text" class="form-control" v-model="editForm.lokasiRak">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" @click="closeEditModal">
                                    Batal
                                </button>
                                <button type="submit" class="btn btn-warning">
                                    <i class="bi bi-save"></i> Simpan Perubahan
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-backdrop fade" :class="{ show: showEditModal }" v-show="showEditModal"></div>

        <!-- PENJELASAN VIDEO: Modal untuk Tambah Bahan Ajar Baru dengan validasi -->
        <div class="modal fade" :class="{ show: showAddModal, 'd-block': showAddModal }" 
             v-show="showAddModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">
                            <i class="bi bi-plus-circle"></i> Tambah Bahan Ajar Baru
                        </h5>
                        <button type="button" class="btn-close btn-close-white" @click="closeAddModal"></button>
                    </div>
                    <div class="modal-body">
                        <form @submit.prevent="saveNewItem">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Kode MK *</label>
                                    <input type="text" class="form-control" v-model="newForm.kode" required>
                                    <small class="text-danger" v-if="validationErrors.kode">{{ validationErrors.kode }}</small>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Nama MK *</label>
                                    <input type="text" class="form-control" v-model="newForm.judul" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Kategori *</label>
                                    <select class="form-select" v-model="newForm.kategori" required>
                                        <option value="">Pilih Kategori</option>
                                        <option value="MKDU">MKDU</option>
                                        <option value="MKDK">MKDK</option>
                                        <option value="MKK">MKK</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">UT Daerah *</label>
                                    <select class="form-select" v-model="newForm.upbjj" required>
                                        <option value="">Pilih UT</option>
                                        <option v-for="upbjj in upbjjList" :key="upbjj" :value="upbjj">
                                            {{ upbjj }}
                                        </option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label fw-semibold">Lokasi Rak *</label>
                                    <input type="text" class="form-control" v-model="newForm.lokasiRak" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label fw-semibold">Jumlah Stok *</label>
                                    <input type="number" class="form-control" v-model.number="newForm.qty" required min="0">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label fw-semibold">Safety Stock *</label>
                                    <input type="number" class="form-control" v-model.number="newForm.safety" required min="0">
                                </div>
                                <div class="col-md-12 mb-3">
                                    <label class="form-label fw-semibold">Harga *</label>
                                    <input type="number" class="form-control" v-model.number="newForm.harga" required min="0">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" @click="closeAddModal">
                                    Batal
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-save"></i> Simpan
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-backdrop fade" :class="{ show: showAddModal }" v-show="showAddModal"></div>

        <!-- PENJELASAN VIDEO: Modal Detail dengan v-html untuk menampilkan HTML content -->
        <div class="modal fade" :class="{ show: showDetailModal, 'd-block': showDetailModal }" 
             v-show="showDetailModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-info text-white">
                        <h5 class="modal-title">
                            <i class="bi bi-info-circle"></i> Detail Bahan Ajar
                        </h5>
                        <button type="button" class="btn-close btn-close-white" @click="showDetailModal = false"></button>
                    </div>
                    <div class="modal-body" v-if="selectedItem">
                        <table class="table table-sm">
                            <tr>
                                <td class="fw-bold">Kode</td>
                                <td>{{ selectedItem.kode }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Nama</td>
                                <td>{{ selectedItem.judul }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Kategori</td>
                                <td>{{ selectedItem.kategori }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">UT Daerah</td>
                                <td>{{ selectedItem.upbjj }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Lokasi Rak</td>
                                <td>{{ selectedItem.lokasiRak }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Stok</td>
                                <td>{{ selectedItem.qty }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Safety Stock</td>
                                <td>{{ selectedItem.safety }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Harga</td>
                                <td>Rp {{ formatCurrency(selectedItem.harga) }}</td>
                            </tr>
                            <tr v-if="selectedItem.catatanHTML">
                                <td class="fw-bold">Catatan</td>
                                <td v-html="selectedItem.catatanHTML"></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-backdrop fade" :class="{ show: showDetailModal }" v-show="showDetailModal"></div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Data -->
    <script src="js/dataBahanAjar.js"></script>
    <!-- App Logic -->
    <script src="js/stok-app.js"></script>
</body>
</html>